
#include "string.h"
#include "Window.h"

#include "OSAL.h"
#include "OSAL_Timer.h"
#include "Task_GUI.h"

#include "LCD_ST7735.h"
#include "UserSetting.h"
#include "UI_Draw.h"

#include "UI_main_icon.h"
#include "ClockTick.h"
#include "Task_Step.h"
#include "Task_Battery.h"

#define COLOR_B      0XF3E0
#define COLOR_F      0xFFFF

#define PEDO_0() (pedometer.counter%10)
#define PEDO_1() ((pedometer.counter/10)%10)
#define PEDO_2() ((pedometer.counter/100)%10)
#define PEDO_3() ((pedometer.counter/1000)%10)

const unsigned char p[] = {0xE0,0xE0,0xE0,0x00,0x00,0x00,0x00,0x00};/*"F:\BandAll\HB030\UI_0923\point.bmp",0*/

void UI_Draw_Buttom(int index, int color)
{
	DrawUI_Bitmap_Ex( 0,144, 80,8, bmp_select,0X8410);

	DrawUI_Bitmap_Ex(10+(index-1)*8,142,8,8,p,color);
}

const unsigned char bmp_battery[][38] = /** 19x16 */
{
{0xC0,0x03,0x38,0x1C,0x08,0x10,0x08,0x10,0x08,0x10,0x08,0x10,0x08,0x10,0x08,0x10,0x08,0x10,0x08,0x10,0x08,0x10,0x08,0x10,0x08,0x10,0x08,0x10,0x08,0x10,0x08,0x10,0x08,0x10,0x08,0x10,0xF8,0x1F},/*"F:\BandAll\HB030\0915\状态栏\battery_level_0.BMP",0*/
{0xC0,0x03,0x38,0x1C,0x08,0x10,0x08,0x10,0x08,0x10,0x08,0x10,0x08,0x10,0x08,0x10,0x08,0x10,0x08,0x10,0x08,0x10,0x08,0x10,0x08,0x10,0xE8,0x17,0xE8,0x17,0xE8,0x17,0xE8,0x17,0x08,0x10,0xF8,0x1F},/*"F:\BandAll\HB030\0915\状态栏\battery_level_1.BMP",0*/
{0xC0,0x03,0x38,0x1C,0x08,0x10,0x08,0x10,0x08,0x10,0x08,0x10,0x08,0x10,0x08,0x10,0xE8,0x17,0xE8,0x17,0xE8,0x17,0xE8,0x17,0x08,0x10,0xE8,0x17,0xE8,0x17,0xE8,0x17,0xE8,0x17,0x08,0x10,0xF8,0x1F},/*"F:\BandAll\HB030\0915\状态栏\battery_level_2.BMP",0*/
{0xC0,0x03,0x38,0x1C,0x08,0x10,0xE8,0x17,0xE8,0x17,0xE8,0x17,0xE8,0x17,0x08,0x10,0xE8,0x17,0xE8,0x17,0xE8,0x17,0xE8,0x17,0x08,0x10,0xE8,0x17,0xE8,0x17,0xE8,0x17,0xE8,0x17,0x08,0x10,0xF8,0x1F},/*"F:\BandAll\HB030\0915\状态栏\battery_level_3.BMP",0*/
};

void UI_Draw_Title(int x, int y)
{
	static unsigned char idx = 0;
	unsigned char level;
	
	if ( power.battery_level > 75 )
	{
		level = 4;
	}else if ( power.battery_level > 45 )
	{
		level = 3;
	}else if ( power.battery_level > 15 )
	{
		level = 2;
	}else if ( power.battery_level >  7 )
	{
		level = 1;
	}else{
		level = 0;
	}

	if ( power.charge_flage == 1 )
	{
		DrawUI_Bitmap_Ex(x,y,19,16,bmp_battery[idx],0x3F<<5);	
		idx++; idx %= 4;
	}else{
		/**
		if ( level < 2 ){
			DrawUI_Bitmap_Ex(x,y,19,16,bmp_battery[level],0x1F<<11);
		}else{
			DrawUI_Bitmap_Ex(x,y,19,16,bmp_battery[level],0x3F<<5);
		}	
		*/
		switch ( level )
		{
		case 4:
			DrawUI_Bitmap_Ex(x,y,19,16,bmp_battery[3],0x3F<<5);
			break;
		case 3:
			DrawUI_Bitmap_Ex(x,y,19,16,bmp_battery[2],0x3F<<5);
			break;
		case 2:
			DrawUI_Bitmap_Ex(x,y,19,16,bmp_battery[1],0x3F<<5);
			break;
		case 1:
			DrawUI_Bitmap_Ex(x,y,19,16,bmp_battery[1],0x1F<<11);
			break;
		case 0:
			DrawUI_Bitmap_Ex(x,y,19,16,bmp_battery[0],0x1F<<11);
			break;
		}
	}	
}

const unsigned char bmp_bluetooth[][36]=  /* 18x16 */
{
{0x00,0x00,0x10,0x04,0x20,0x02,0x40,0x01,0xFE,0x7F,0x82,0x40,0x44,0x21,0x28,0x12,0x10,0x0C,0x00,0x00,0x20,0x02,0xC8,0x09,0x10,0x04,0xE4,0x13,0x08,0x08,0xF0,0x07,0x00,0x00,0x00,0x00},/*"F:\BandAll\HB030\0915\状态栏\ble_off`.BMP",0*/
{0x00,0x00,0x10,0x04,0x20,0x02,0x40,0x01,0xFE,0x7F,0x82,0x40,0x44,0x21,0x28,0x12,0x10,0x0C,0x00,0x00},/*"F:\BandAll\HB030\0915\状态栏\ble_on.BMP",0*/
};
void UI_Draw_Title_Bluetooth(int x, int y)
{
	if ( ble.isConnected == 0 )
	{		
		DrawUI_Bitmap_Ex(x+4,y,18,16,bmp_bluetooth[0],0xFFFF<<0);
	}else
	{
		DrawUI_Bitmap_Ex(x+8,y,10,16,bmp_bluetooth[1],0xFFFF<<0);
	}	
}


void UI_Draw_Picture(int x, int y, int w, int h, const unsigned char *p)
{
	draw_bitmap(x, y, w, h, p);
}

int level_convert( int level )
{
	if ( level > 75 )
	{
		return 4;
	}else if ( level > 55 )
	{
		return 3;
	}else if ( level > 40 )
	{
		return 2;
	}else if ( level > 20 )
	{
		return 1;
	}else 
	{
		return 0;
	}
}

#define ALIGN_CENTER 0
#define ALIGN_LEFT   1
#define ALIGN_RIGHT  2

#define FONT_7X9_W 7
#define FONT_7X9_H 9

typedef struct
{
	int w, h;
	unsigned char *p;
}Font;

//Font Font7X9 = {
//	.w = FONT_7X9_W,
//	.h = FONT_7X9_H,
//	.p = (unsigned char *)Font7x9_2,
//};

//Font Font7X9_2 = {
//	.w = FONT_7X9_W,
//	.h = FONT_7X9_H,
//	.p = (unsigned char *)Font_7x9,
//};


#define COLOR_B      0XF3E0
#define COLOR_F      0xFFFF

void ui_show_val( int x, int y, int val, Font * font, int align)
{
	int width = 0, v = val;
	int w, h, idx, sx, ex;
	
	w = font->w; h = font->h;
	
	unsigned char *p;
	
	p = (unsigned char *)font->p;
	
	do{
		width++;
		v /= 10;
	}while(v>0);
	
	if ( align == ALIGN_CENTER )
	{
		sx = x+((80-x) - width*w)/2;
	}else if ( align == ALIGN_LEFT )
	{
		sx = x;
	}else if ( align == ALIGN_RIGHT )
	{
		sx = 80-width*w;
	}else{
		sx = x; // defalut
	}
	
	ex = sx + (width-1) * w;
	do
	{
		idx = val % 10;
		draw_bitmap(ex, y, w, h, p+idx*(w*h*2));
		val /= 10; ex -= w;
	}while( val > 0 );
}

const unsigned char Week[][52] = {
{0x00,0x00,0x00,0x00,0x00,0x00,0xF0,0x08,0x08,0x11,0x08,0x11,0x08,0x11,0x10,0x0E,0x00,0x00,0xF8,0x0F,0x00,0x10,0x00,0x10,0x00,0x10,0x00,0x10,0xF8,0x0F,0x00,0x00,0xF8,0x1F,0x30,0x00,0xC0,0x00,0x00,0x03,0x00,0x0C,0xF8,0x1F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},/*"F:\BandAll\HB030\1009\SUM.BMP",0*/
{0x00,0x00,0x00,0x00,0xF8,0x1F,0x10,0x00,0x20,0x00,0xC0,0x1F,0x20,0x00,0x10,0x00,0xF8,0x1F,0x00,0x00,0xE0,0x07,0x10,0x08,0x08,0x10,0x08,0x10,0x08,0x10,0x10,0x08,0xE0,0x07,0x00,0x00,0xF8,0x1F,0x10,0x00,0x60,0x00,0x80,0x01,0x00,0x06,0x00,0x08,0xF8,0x1F,0x00,0x00},/*"F:\BandAll\HB030\0915\星期_36x16\修改26x16_9.15\MON.BMP",0*/
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x08,0x00,0x08,0x00,0xF8,0x1F,0x08,0x00,0x08,0x00,0x00,0x00,0xF8,0x0F,0x00,0x10,0x00,0x10,0x00,0x10,0x00,0x10,0xF8,0x0F,0x00,0x00,0xF8,0x1F,0x88,0x10,0x88,0x10,0x88,0x10,0x88,0x10,0x88,0x10,0x00,0x00,0x00,0x00,0x00,0x00},/*"F:\BandAll\HB030\0915\星期_36x16\修改26x16_9.15\TUE.BMP",0*/
{0x00,0x00,0x00,0x00,0x00,0x00,0xF8,0x1F,0x00,0x08,0x00,0x04,0xF8,0x03,0x00,0x04,0x00,0x08,0xF8,0x1F,0x00,0x00,0xF8,0x1F,0x88,0x10,0x88,0x10,0x88,0x10,0x88,0x10,0x00,0x00,0xF8,0x1F,0x08,0x10,0x08,0x10,0x08,0x10,0x10,0x08,0xE0,0x07,0x00,0x00,0x00,0x00,0x00,0x00},/*"F:\BandAll\HB030\0915\星期_36x16\修改26x16_9.15\WED.BMP",0*/
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x08,0x00,0x08,0x00,0xF8,0x1F,0x08,0x00,0x08,0x00,0x00,0x00,0xF8,0x1F,0x80,0x00,0x80,0x00,0x80,0x00,0x80,0x00,0xF8,0x1F,0x00,0x00,0xF8,0x0F,0x00,0x10,0x00,0x10,0x00,0x10,0x00,0x10,0xF8,0x0F,0x00,0x00,0x00,0x00,0x00,0x00},/*"F:\BandAll\HB030\0915\星期_36x16\修改26x16_9.15\THU.BMP",0*/
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xF8,0x1F,0x88,0x00,0x88,0x00,0x88,0x00,0x88,0x00,0x00,0x00,0xF8,0x1F,0x88,0x00,0x88,0x00,0x88,0x00,0x88,0x00,0x70,0x1F,0x00,0x00,0x00,0x00,0xF8,0x1F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},/*"F:\BandAll\HB030\0915\星期_36x16\修改26x16_9.15\FRI.BMP",0*/
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x70,0x08,0x88,0x10,0x88,0x10,0x88,0x10,0x10,0x0F,0x00,0x00,0xC0,0x1F,0xA0,0x00,0x90,0x00,0x88,0x00,0x90,0x00,0xA0,0x00,0xC0,0x1F,0x08,0x00,0x08,0x00,0xF8,0x1F,0x08,0x00,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00},/*"F:\BandAll\HB030\0915\星期_36x16\修改26x16_9.15\SAT.BMP",0*/
};

inline void Draw_Week( int x, int y, int week)
{
   DrawUI_Bitmap_Ex(54,0,26,16,Week[week],0XFFFF);	
}

#include "UI_comm_icon.h"

const unsigned char Month[][52] = 
{
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x18,0x00,0x20,0x00,0x20,0x00,0x20,0xFC,0x1F,0x00,0x00,0x80,0x18,0x40,0x24,0x40,0x22,0x40,0x12,0x80,0x3F,0x00,0x20,0x00,0x00,0x80,0x3F,0x40,0x00,0x40,0x00,0x40,0x00,0x80,0x3F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},/*"F:\BandAll\HB030\0915\月份_26x16\jan.BMP",0*/
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xF8,0x1F,0x88,0x00,0x88,0x00,0x88,0x00,0x88,0x00,0x00,0x00,0xC0,0x0F,0x20,0x11,0x20,0x11,0x20,0x11,0xC0,0x0D,0x00,0x00,0xF8,0x0F,0x40,0x10,0x20,0x10,0x20,0x10,0x40,0x10,0x80,0x0F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},/*"F:\BandAll\HB030\0915\月份_26x16\feb.bmp",0*/
{0x00,0x00,0x00,0x00,0x00,0x00,0xF8,0x1F,0x10,0x00,0xE0,0x00,0x00,0x07,0x00,0x18,0x00,0x07,0xE0,0x00,0x10,0x00,0xF8,0x1F,0x00,0x00,0x40,0x0E,0x20,0x11,0x20,0x11,0x20,0x11,0xC0,0x0F,0x00,0x10,0x00,0x00,0xE0,0x1F,0x40,0x00,0x20,0x00,0x00,0x00,0x00,0x00,0x00,0x00},/*"F:\BandAll\HB030\0915\月份_26x16\mar.bmp",0*/
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x07,0xF8,0x01,0x0E,0x01,0x0E,0x01,0xF8,0x01,0x80,0x07,0x00,0x00,0x00,0x00,0xE0,0x3F,0x10,0x04,0x10,0x04,0x10,0x04,0xE0,0x03,0x00,0x00,0x00,0x00,0xF0,0x0F,0x20,0x00,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},/*"F:\BandAll\HB030\0915\月份_26x16\apr.bmp",0*/
{0x00,0x00,0x00,0x00,0xFE,0x0F,0x04,0x00,0xF8,0x00,0x80,0x03,0x00,0x0C,0x80,0x03,0x78,0x00,0x04,0x00,0xFE,0x0F,0x00,0x00,0x20,0x07,0x90,0x08,0x90,0x08,0x90,0x08,0xE0,0x07,0x00,0x08,0x70,0x00,0xC0,0x21,0x00,0x1E,0x00,0x03,0xE0,0x00,0x10,0x00,0x00,0x00,0x00,0x00},/*"F:\BandAll\HB030\0915\月份_26x16\may.bmp",0*/
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x18,0x00,0x20,0x00,0x20,0x00,0x20,0xFC,0x1F,0x00,0x00,0x00,0x00,0xC0,0x1F,0x00,0x20,0x00,0x20,0x00,0x20,0xC0,0x1F,0x00,0x00,0x00,0x00,0x80,0x3F,0x40,0x00,0x40,0x00,0x40,0x00,0x80,0x3F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},/*"F:\BandAll\HB030\0915\月份_26x16\jun.BMP",0*/
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x18,0x00,0x20,0x00,0x20,0x00,0x20,0xFC,0x1F,0x00,0x00,0x00,0x00,0xC0,0x1F,0x00,0x20,0x00,0x20,0x00,0x20,0xC0,0x1F,0x00,0x00,0x00,0x00,0xFC,0x3F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},/*"F:\BandAll\HB030\0915\月份_26x16\jul.BMP",0*/
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0E,0xE0,0x03,0x38,0x01,0x0E,0x01,0x38,0x01,0xE0,0x03,0x00,0x0E,0x00,0x00,0xF0,0x07,0x00,0x08,0x00,0x08,0x00,0x08,0xF0,0x07,0x00,0x00,0x00,0x00,0xE0,0x13,0x10,0x24,0x10,0x24,0x10,0x24,0xE0,0x1F,0x00,0x00,0x00,0x00,0x00,0x00},/*"F:\BandAll\HB030\0915\月份_26x16\aug.bmp",0*/
{0x00,0x00,0x3C,0x06,0x42,0x08,0x42,0x08,0x42,0x08,0x42,0x08,0x8C,0x07,0x00,0x00,0x00,0x00,0xE0,0x07,0x90,0x08,0x90,0x08,0x90,0x08,0xE0,0x04,0x00,0x00,0xE0,0x3F,0x10,0x04,0x10,0x04,0x10,0x04,0xE0,0x03,0x00,0x00,0x10,0x00,0xFC,0x07,0x10,0x08,0x10,0x08,0x00,0x00},/*"F:\BandAll\HB030\0915\月份_26x16\sept.bmp",0*/
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xF0,0x0F,0x08,0x10,0x04,0x20,0x04,0x20,0x04,0x20,0x08,0x10,0xF0,0x0F,0x00,0x00,0xC0,0x1F,0x20,0x20,0x20,0x20,0x20,0x20,0xC0,0x18,0x00,0x00,0x20,0x00,0xF8,0x1F,0x20,0x20,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},/*"F:\BandAll\HB030\0915\月份_26x16\oct.BMP",0*/
{0x00,0x00,0x00,0x00,0xFC,0x3F,0x08,0x00,0x70,0x00,0x80,0x03,0x00,0x0E,0x00,0x10,0xFC,0x3F,0x00,0x00,0x00,0x00,0xC0,0x1F,0x20,0x20,0x20,0x20,0x20,0x20,0xC0,0x1F,0x00,0x00,0x00,0x00,0x60,0x00,0x80,0x0F,0x00,0x30,0x80,0x0F,0x60,0x00,0x00,0x00,0x00,0x00,0x00,0x00},/*"F:\BandAll\HB030\0915\月份_26x16\nov.BMP",0*/
{0x00,0x00,0x00,0x00,0x00,0x00,0xF8,0x1F,0x08,0x10,0x08,0x10,0x08,0x10,0x08,0x10,0x10,0x08,0xE0,0x07,0x00,0x00,0xC0,0x0F,0x20,0x11,0x20,0x11,0x20,0x11,0xC0,0x09,0x00,0x00,0xC0,0x0F,0x20,0x10,0x20,0x10,0x20,0x10,0x40,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},/*"F:\BandAll\HB030\0915\月份_26x16\dec.bmp",0*/
};

void show_main_ui_style_1(void)
{
	draw_bitmap(0,0,79,160,gImage_bg);
	// draw_fill( 0, 159, 80, 1,0x0000);
	
	// Draw Bluetooth and Title
	UI_Draw_Title_Bluetooth(0,0);
	UI_Draw_Title(24,0);
	
	// Draw Week Day
	
	if ( config.time_format == 0 )
	{
		// 24小时制,显示星期
		Draw_Week(48, 144, TimerWK());	
	} else {
		// 12小时制,显示AM/PM

		if ( TimerHH() > 11 )
		{
			DrawUI_Bitmap_Ex(64-4, 0, 16, 16, bmp_pm,0XFFFF);
		}else{
			DrawUI_Bitmap_Ex(63-4, 0, 17, 16, bmp_am,0XFFFF);
		}		
	}
	
	// Draw Time
	int hour = TimerHH();
	if ( config.time_format == 1 )
	{
		if ( hour > 11 )
		{
			hour -= 12;
		}
		if ( hour == 0 )
		{
			hour = 12;
		}
	}
	
	DrawUI_Bitmap_Ex( 8,32,24,40,Font24x40[hour/10],0X97E0);
	DrawUI_Bitmap_Ex(44,32,24,40,Font24x40[hour%10],0X97E0);
	
	DrawUI_Bitmap_Ex( 8+2,96,24,40,Font24x40[10+TimerMI()/10],0X073F);
	DrawUI_Bitmap_Ex(44-2,96,24,40,Font24x40[10+TimerMI()%10],0X073F);
	
	// Draw Date
	DrawUI_Bitmap_Ex( 8, 76, 26, 16, Month[TimerMM()-1],0xFFFF);
	DrawUI_Bitmap_Ex(44+3,76, 7, 16,Font_7x16[TimerDD()/10], 0xFFFF);
	DrawUI_Bitmap_Ex(44+3+7,76, 7, 16,Font_7x16[TimerDD()%10], 0xFFFF);

	if ( power.debug == 1 )
	{		
		int val = current_adc;
		int x = 7*3-7;
		int y = 144;
		do{
			DrawUI_Bitmap( x,y, 7, 16,Font_7x16[val%10], COLOR_F,0x000);
			val /= 10; x -= 7;
		}while(val>0);	

		DrawUI_Bitmap( 37-12,y, 7, 16,Font_7x16[(power.battery_level/100)%10], COLOR_F,0x000);
		DrawUI_Bitmap( 44-12,y, 7, 16,Font_7x16[(power.battery_level/10)%10], COLOR_F,0x000);
		DrawUI_Bitmap( 51-12,y, 7, 16,Font_7x16[power.battery_level%10], COLOR_F,0x000);
		
		int h = (int)power.voltage;
		int l = (int)((power.voltage - h)*100);
		
		DrawUI_Bitmap( 58-7,y, 7, 16,Font_7x16[h], COLOR_F,0x000);
		DrawUI_Bitmap( 65-7,y, 7, 16,Font_7x16[10], COLOR_F,0x000);
		DrawUI_Bitmap( 72-7,y, 7, 16,Font_7x16[l/10], COLOR_F,0x000);	
		DrawUI_Bitmap( 79-7,y, 7, 16,Font_7x16[l%10], COLOR_F,0x000);	
	}
}

#define PI 3.14159265       
#include "math.h"

const unsigned char bmp_battery_1[][38] = /** 19x16 */
{
{0x00,0x00,0xF0,0x0F,0x10,0x08,0x10,0x08,0x10,0x08,0x10,0x08,0x10,0x08,0x10,0x08,0x10,0x08,0x10,0x08,0x10,0x08,0x10,0x08,0x10,0x08,0x10,0x08,0x10,0x08,0x70,0x0E,0xC0,0x03,0x00,0x00,0x00,0x00},/*"F:\Band\HB021\尼加亚彩屏_80x160\尼加亚彩屏_80x160\切图\主界面\battery\battery_level_0.BMP",0*/
{0x00,0x00,0xF0,0x0F,0x10,0x08,0xD0,0x0B,0xD0,0x0B,0xD0,0x0B,0x10,0x08,0x10,0x08,0x10,0x08,0x10,0x08,0x10,0x08,0x10,0x08,0x10,0x08,0x10,0x08,0x10,0x08,0x70,0x0E,0xC0,0x03,0x00,0x00,0x00,0x00},/*"F:\Band\HB021\尼加亚彩屏_80x160\尼加亚彩屏_80x160\切图\主界面\battery\battery_level_1.BMP",0*/
{0x00,0x00,0xF0,0x0F,0x10,0x08,0xD0,0x0B,0xD0,0x0B,0xD0,0x0B,0x10,0x08,0xD0,0x0B,0xD0,0x0B,0xD0,0x0B,0x10,0x08,0x10,0x08,0x10,0x08,0x10,0x08,0x10,0x08,0x70,0x0E,0xC0,0x03,0x00,0x00,0x00,0x00},/*"F:\Band\HB021\尼加亚彩屏_80x160\尼加亚彩屏_80x160\切图\主界面\battery\battery_level_2.BMP",0*/
{0x00,0x00,0xF0,0x0F,0x10,0x08,0xD0,0x0B,0xD0,0x0B,0xD0,0x0B,0x10,0x08,0xD0,0x0B,0xD0,0x0B,0xD0,0x0B,0x10,0x08,0xD0,0x0B,0xD0,0x0B,0xD0,0x0B,0x10,0x08,0x70,0x0E,0xC0,0x03,0x00,0x00,0x00,0x00},/*"F:\Band\HB021\尼加亚彩屏_80x160\尼加亚彩屏_80x160\切图\主界面\battery\battery_level_3.BMP",0*/
};

void UI_Draw_Title_1(void)
{
	static unsigned char idx = 0;
	unsigned char level;
	
	if ( power.battery_level > 75 )
	{
		level = 4;
	}else if ( power.battery_level > 45 )
	{
		level = 3;
	}else if ( power.battery_level > 15 )
	{
		level = 2;
	}else if ( power.battery_level > 7 )
	{
		level = 1;
	}
	else{
		level = 0;
	}

	if ( power.charge_flage == 1 )
	{
		DrawUI_Bitmap_Ex((80-19)/2,24,19,16,bmp_battery_1[idx],0x3F<<5);	
		idx++; idx %= 4;
	}else{
		/**
		if ( level < 2 ){
			DrawUI_Bitmap_Ex((80-19)/2,24,19,16,bmp_battery_1[level],0x1F<<11);
		}else{
			DrawUI_Bitmap_Ex((80-19)/2,24,19,16,bmp_battery_1[level],0x3F<<5);
		} */

		switch ( level )
		{
		case 4:
			DrawUI_Bitmap_Ex((80-19)/2,24,19,16,bmp_battery_1[3],0x3F<<5);
			break;
		case 3:
			DrawUI_Bitmap_Ex((80-19)/2,24,19,16,bmp_battery_1[2],0x3F<<5);
			break;			
		case 2:
			DrawUI_Bitmap_Ex((80-19)/2,24,19,16,bmp_battery_1[1],0x3F<<5);
			break;			
		case 1:
			DrawUI_Bitmap_Ex((80-19)/2,24,19,16,bmp_battery_1[1],0x1F<<11);
			break;			
		case 0:
			DrawUI_Bitmap_Ex((80-19)/2,24,19,16,bmp_battery_1[0],0x1F<<11);
			break;			
		}
	}	
}

const unsigned char bmp_bluetooth_1[][24]=  /* 12x16 */
{
  {0xFF,0xFF,0xBF,0xFB,0x7F,0xFD,0x0F,0xE0,0xEF,0xEE,0x5F,0xF5,0xBF,0xFB,0xFF,0xFE,0xBF,0xFB,0x7F,0xFC,0xDF,0xF7,0x3F,0xF8},/*"F:\BandAll\HB022\HB022Éè±¸UI\DennyÐÞ¸Ä\Ð¡Í¼±ê\ble_off.BMP",0*/
  {0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xBF,0xFB,0x7F,0xFD,0x0F,0xE0,0xEF,0xEE,0x5F,0xF5,0xBF,0xFB,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF},/*"F:\BandAll\HB022\HB022Éè±¸UI\DennyÐÞ¸Ä\Ð¡Í¼±ê\ble_on.BMP",0*/
};
void UI_Draw_Title_Bluetooth_1(void)
{
	if ( ble.isConnected == 0 )
	{		
		DrawUI_Bitmap_Rever((80-12)/2-2,120,12,16,bmp_bluetooth_1[0],0x1F<<0);
	}else
	{
		DrawUI_Bitmap_Rever((80-12)/2-1,120,12,16,bmp_bluetooth_1[1],0x1F<<0);
	}	
}

void show_main_ui_style_2(int hour, int minute, int second)
{
	DrawUI_Bitmap(0,0, 80, 160,BMP_timer, 0xFFFF,0x0000);

	float h_second = (float)(second * 2 *PI /60.0f);
	float  h_minute = (float)(minute * 2 * PI/60.0f+h_second/60.0f);
	float h_hour = (float)(hour * 2 * PI/12.0f+h_minute/12.0f);
	
	int x_minute = (int)(30*sin(h_minute));
	int y_minute = (int)(30*cos(h_minute));
	
	int x_hour = (int)(24*sin(h_hour));
	int y_hour = (int)(24*cos(h_hour));		
		
	// 绘制时针、分针和秒针
	draw_line( 39+x_hour, 79-y_hour,39-x_hour/3,79+y_hour/3,0xFFFF); 
	draw_line( 40+x_hour, 80-y_hour,40-x_hour/3,80+y_hour/3,0xFFFF);
	
	draw_line( 39+x_minute, 79-y_minute,39-x_minute/3,79+y_minute/3,0xFFFF);
	draw_line( 40+x_minute, 80-y_minute,40-x_minute/3,80+y_minute/3,0xFFFF);		
	
	UI_Draw_Title_Bluetooth_1();
	UI_Draw_Title_1();	
}

unsigned char fristBootFlag = 1;
unsigned char showLogoFlag = 0;
	
void show_ui_version(void);
void show_ui_logo(void)
{	
}

const unsigned char Font_7x12[][14] = 
{
{0xF0,0x00,0x0C,0x03,0x04,0x02,0x04,0x02,0x08,0x03,0xF0,0x00,0x00,0x00},/*"0",0*/
{0x00,0x00,0x08,0x02,0x08,0x02,0xFC,0x03,0x00,0x02,0x00,0x02,0x00,0x00},/*"1",1*/
{0x00,0x00,0x18,0x03,0x84,0x02,0x44,0x02,0x24,0x02,0x18,0x02,0x00,0x00},/*"2",2*/
{0x00,0x00,0x08,0x01,0x04,0x02,0x24,0x02,0x24,0x02,0xD8,0x01,0x00,0x00},/*"3",3*/
{0x40,0x00,0xA0,0x00,0x90,0x00,0x88,0x00,0xFC,0x03,0x80,0x02,0x00,0x00},/*"4",4*/
{0x00,0x00,0x3C,0x01,0x24,0x02,0x24,0x02,0x24,0x02,0xC4,0x01,0x00,0x00},/*"5",5*/
{0xF0,0x01,0x48,0x02,0x24,0x02,0x24,0x02,0x24,0x02,0xCC,0x01,0x00,0x00},/*"6",6*/
{0x00,0x00,0x0C,0x00,0x04,0x00,0xE4,0x03,0x14,0x00,0x0C,0x00,0x00,0x00},/*"7",7*/
{0xD8,0x01,0x24,0x02,0x24,0x02,0x44,0x02,0x64,0x02,0x98,0x01,0x00,0x00},/*"8",8*/
{0x38,0x03,0x44,0x02,0x44,0x02,0x44,0x02,0x24,0x01,0xF8,0x00,0x00,0x00},/*"9",9*/	
};

const unsigned char FChip_Text[][14] = {
{0x04,0x02,0xFC,0x03,0x24,0x02,0x24,0x00,0x74,0x00,0x04,0x00,0x08,0x00},/*"F",0*/
{0x20,0x00,0x20,0x00,0x20,0x00,0x20,0x00,0x20,0x00,0x20,0x00,0x00,0x00},/*"-",1*/
{0xF0,0x00,0x08,0x03,0x04,0x02,0x04,0x02,0x04,0x02,0x0C,0x01,0x00,0x00},/*"C",2*/
{0x04,0x02,0xFC,0x03,0x20,0x02,0x20,0x00,0x20,0x02,0xC0,0x03,0x00,0x02},/*"h",3*/
{0x00,0x00,0x20,0x02,0x20,0x02,0xE4,0x03,0x00,0x02,0x00,0x02,0x00,0x00},/*"i",4*/
{0x20,0x08,0xE0,0x0F,0x20,0x0A,0x20,0x02,0x20,0x02,0xC0,0x01,0x00,0x00},/*"p",5*/
};
	
const unsigned char FChip_Error[][14] = 
{
{0x04,0x02,0xFC,0x03,0x24,0x02,0x24,0x02,0x74,0x02,0x0C,0x03,0x00,0x00},/*"E",0*/
{0x20,0x02,0x20,0x02,0xE0,0x03,0x40,0x02,0x20,0x02,0x20,0x00,0x00,0x00},/*"r",1*/
{0x20,0x02,0x20,0x02,0xE0,0x03,0x40,0x02,0x20,0x02,0x20,0x00,0x00,0x00},/*"r",2*/
{0x00,0x00,0xC0,0x01,0x20,0x02,0x20,0x02,0x20,0x02,0xC0,0x01,0x00,0x00},/*"o",3*/
{0x20,0x02,0x20,0x02,0xE0,0x03,0x40,0x02,0x20,0x02,0x20,0x00,0x00,0x00},/*"r",4*/	
};

const unsigned char GSensor_Text[][14] = 
{
{0xF0,0x00,0x08,0x01,0x04,0x02,0x04,0x02,0x44,0x02,0xCC,0x01,0x40,0x00},/*"G",0*/
{0x20,0x00,0x20,0x00,0x20,0x00,0x20,0x00,0x20,0x00,0x20,0x00,0x00,0x00},/*"-",1*/
{0x00,0x00,0x18,0x03,0x24,0x02,0x24,0x02,0x44,0x02,0xCC,0x01,0x00,0x00},/*"S",2*/
{0x00,0x00,0xC0,0x01,0xA0,0x02,0xA0,0x02,0xA0,0x02,0xC0,0x02,0x00,0x00},/*"e",3*/
{0x20,0x02,0xE0,0x03,0x40,0x02,0x20,0x00,0x20,0x02,0xC0,0x03,0x00,0x02},/*"n",4*/
{0x00,0x00,0x60,0x03,0xA0,0x02,0xA0,0x02,0xA0,0x02,0x20,0x03,0x00,0x00},/*"s",5*/
{0x00,0x00,0xC0,0x01,0x20,0x02,0x20,0x02,0x20,0x02,0xC0,0x01,0x00,0x00},/*"o",6*/
{0x20,0x02,0x20,0x02,0xE0,0x03,0x40,0x02,0x20,0x02,0x20,0x00,0x00,0x00},/*"r",7*/	
};

const unsigned char OK[][14] = 
{
{0xF0,0x00,0x08,0x03,0x04,0x02,0x04,0x02,0x0C,0x03,0xF0,0x00,0x00,0x00},/*"O",0*/
{0x04,0x02,0xFC,0x03,0x24,0x02,0x74,0x00,0x9C,0x02,0x0C,0x03,0x04,0x02},/*"K",1*/
};

const unsigned char HR_Text[][14] = 
{
{0x04,0x02,0xFC,0x03,0x24,0x02,0x20,0x00,0x24,0x02,0xFC,0x03,0x04,0x02},/*"H",0*/
{0x04,0x02,0xFC,0x03,0x24,0x02,0x64,0x00,0xA4,0x00,0x18,0x03,0x00,0x02},/*"R",1*/
};

#include "version.h"

const unsigned char GSensor_Wait[] = {0x00,0x18,0x18,0x00,0x00,0x00,0x18,0x18,0x00,0x00,0x00,0x18,0x18,0x00,0x00,0x00};/*"未命名文件",0*/	
const unsigned char line_[] = {0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01};/*"F:\HW011_4\Test\00.BMP",0*/
extern bool font_is_ok(void);
extern unsigned long gsensor_ok;
extern short current_touch_adc;
	
const unsigned char Font_str[][27] = 
{

{0x20,0x00,0x10,0xE0,0xFF,0x1F,0xE0,0xFF,0x1F,0x20,0x10,0x10,0x20,0x10,0x00,0x20,0x7C,0x00,0x60,0x7C,0x00,0xE0,0x01,0x00,0x80,0x01,0x00},/*"F",0*/

{0x00,0x00,0x00,0x00,0xE0,0x07,0x00,0xF8,0x0F,0x00,0x1C,0x18,0x00,0x04,0x10,0x00,0x04,0x10,0x00,0x1C,0x1C,0x00,0xF8,0x0F,0x00,0xE0,0x03},/*"o",1*/

{0x00,0x04,0x10,0x00,0xFC,0x1F,0x00,0xFC,0x1F,0x00,0x08,0x10,0x00,0x0C,0x00,0x00,0x04,0x00,0x00,0x0C,0x10,0x00,0xFC,0x1F,0x00,0xF8,0x1F},/*"n",2*/

{0x00,0x00,0x00,0x00,0x04,0x00,0x00,0x04,0x00,0xC0,0xFF,0x0F,0xC0,0xFF,0x1F,0x00,0x04,0x10,0x00,0x04,0x18,0x00,0x00,0x08,0x00,0x00,0x00},/*"t",3*/

};	

const unsigned char GS_str[][27] = 
{


{0x00,0xFE,0x01,0x80,0xFF,0x07,0xC0,0x01,0x0E,0x60,0x00,0x18,0x20,0x00,0x10,0x20,0x00,0x10,0x60,0x40,0x10,0xE0,0xC1,0x1F,0xE0,0xC1,0x0F},/*"G",0*/

{0x00,0x00,0x00,0x80,0x07,0x1F,0xC0,0x0F,0x1F,0x60,0x18,0x18,0x20,0x10,0x10,0x20,0x30,0x10,0x60,0x60,0x18,0xE0,0xE1,0x0F,0xE0,0x81,0x07},/*"S",1*/

{0x00,0x00,0x00,0x00,0xF0,0x07,0x00,0xF8,0x0F,0x00,0x4C,0x1C,0x00,0x44,0x10,0x00,0x44,0x10,0x00,0x4C,0x18,0x00,0x78,0x1C,0x00,0x70,0x04},/*"e",2*/

{0x00,0x04,0x10,0x00,0xFC,0x1F,0x00,0xFC,0x1F,0x00,0x08,0x10,0x00,0x0C,0x00,0x00,0x04,0x00,0x00,0x0C,0x10,0x00,0xFC,0x1F,0x00,0xF8,0x1F},/*"n",3*/

{0x00,0x04,0x10,0x00,0x04,0x10,0x00,0xFC,0x1F,0x00,0xFC,0x1F,0x00,0x18,0x10,0x00,0x0C,0x10,0x00,0x04,0x00,0x00,0x0C,0x00,0x00,0x0C,0x00},/*"r",4*/


};
	
const unsigned char Batt[][27] = 
{
{0x20,0x00,0x10,0xE0,0xFF,0x1F,0xE0,0xFF,0x1F,0x20,0x10,0x10,0x20,0x10,0x10,0x60,0x18,0x10,0xE0,0x3F,0x18,0xC0,0xE7,0x0F,0x00,0xC0,0x07},/*"B",0*/
{0x00,0x00,0x00,0x00,0x18,0x0F,0x00,0xDC,0x1F,0x00,0xC4,0x18,0x00,0x64,0x10,0x00,0x24,0x18,0x00,0xFC,0x1F,0x00,0xF8,0x1F,0x00,0x00,0x18},/*"a",1*/
{0x00,0x00,0x00,0x00,0x04,0x00,0x00,0x04,0x00,0xC0,0xFF,0x0F,0xC0,0xFF,0x1F,0x00,0x04,0x10,0x00,0x04,0x18,0x00,0x00,0x08,0x00,0x00,0x00},/*"t",2*/
{0x00,0x00,0x00,0x00,0x04,0x00,0x00,0x04,0x00,0xC0,0xFF,0x0F,0xC0,0xFF,0x1F,0x00,0x04,0x10,0x00,0x04,0x18,0x00,0x00,0x08,0x00,0x00,0x00},/*"t",3*/
};

const unsigned char Hr[][27] = 
{
{0x20,0x00,0x10,0xE0,0xFF,0x1F,0xE0,0xFF,0x1F,0x20,0x10,0x10,0x00,0x10,0x00,0x20,0x10,0x10,0xE0,0xFF,0x1F,0xE0,0xFF,0x1F,0x20,0x00,0x10},/*"H",0*/
{0x20,0x00,0x10,0xE0,0xFF,0x1F,0xE0,0xFF,0x1F,0x20,0x10,0x10,0x20,0x70,0x00,0x60,0xF8,0x03,0xE0,0x8F,0x1F,0xC0,0x07,0x1C,0x00,0x00,0x10},/*"R",1*/
};

const unsigned char OK_[] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x01,0x00,0x80,0x07,0x00,0x00,0x1F,0x00,0x00,0x78,0x00,0x00,0xF0,0x01,0x00,0x80,0x03,0x00,0x80,0x03,0x00,0xC0,0x01,0x00,0xE0,0x00,0x00,0x70,0x00,0x00,0x18,0x00,0x00,0x0E,0x00,0x00,0x07,0x00,0x80,0x03,0x00,0xC0,0x01,0x00,0xC0,0x00,0x00,0x70,0x00,0x00,0x30,0x00,0x00,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};/*"F:\OK.BMP",0*/
const unsigned char ERR_[] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x60,0x80,0x01,0xC0,0xC0,0x00,0x80,0x41,0x00,0x00,0x33,0x00,0x00,0x16,0x00,0x00,0x0C,0x00,0x00,0x1C,0x00,0x00,0x16,0x00,0x00,0x63,0x00,0x80,0x41,0x00,0x80,0xC0,0x00,0xC0,0x80,0x01,0x60,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};/*"未命名文件",0*/ 

void UI_Draw_Title_test(int x, int y)
{
	static unsigned char idx = 0;
	unsigned char level;
	
	if ( power.battery_level > 75 )
	{
		level = 4;
	}else if ( power.battery_level > 45 )
	{
		level = 3;
	}else if ( power.battery_level > 15 )
	{
		level = 2;
	}else if ( power.battery_level > 7 )
	{
		level = 1;
	}
	else{
		level = 0;
	}

	if ( power.charge_flage == 1 )
	{
		DrawUI_Bitmap_Ex(x,y,19,16,bmp_battery_1[idx],0x3F<<5);	
		idx++; idx %= 4;
	}else{
		switch ( level )
		{
		case 4:
			DrawUI_Bitmap_Ex(x,y,19,16,bmp_battery_1[3],0x3F<<5);
			break;
		case 3:
			DrawUI_Bitmap_Ex(x,y,19,16,bmp_battery_1[2],0x3F<<5);
			break;			
		case 2:
			DrawUI_Bitmap_Ex(x,y,19,16,bmp_battery_1[1],0x3F<<5);
			break;			
		case 1:
			DrawUI_Bitmap_Ex(x,y,19,16,bmp_battery_1[1],0x1F<<11);
			break;			
		case 0:
			DrawUI_Bitmap_Ex(x,y,19,16,bmp_battery_1[0],0x1F<<11);
			break;			
		}
	}	
}	

#if (OTA_MODE_ENABLE==0)

const unsigned char FONT_s[][32]=
{
{0x10,0x02,0x1C,0x02,0x0C,0x02,0x24,0x02,0x24,0x02,0x24,0x42,0x25,0xC2,0x27,0xFF,0xA6,0x7F,0xE4,0x02,0x64,0x02,0x24,0x02,0x04,0x02,0x14,0x02,0x1C,0x02,0x0C,0x02},/*"字",0*/
{0x00,0x40,0x00,0x70,0xFC,0x3F,0xFC,0x1F,0x24,0x13,0xA4,0x13,0xE4,0x12,0x7D,0x12,0xBF,0xFF,0xA6,0xFF,0x24,0x12,0x24,0x12,0x24,0x12,0x24,0x12,0x24,0x10,0x04,0x10},/*"库",1*/
};

const unsigned char GSensor_s[][32] = 
{
{0x40,0x00,0x40,0x00,0x42,0x00,0xCE,0x7F,0xCC,0x7F,0x40,0x30,0x40,0x10,0x40,0x00,0x40,0x00,0xFF,0xFF,0xFF,0xFF,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00},/*"计",0*/
{0x40,0x80,0x40,0x90,0x40,0x98,0x7C,0xCE,0x7C,0x46,0x40,0x40,0x40,0x60,0xFF,0x2F,0xFF,0x3F,0x44,0x10,0x44,0x18,0x44,0x0C,0x44,0x06,0x44,0x02,0x40,0x00,0x40,0x00},/*"步",1*/	
};

const unsigned char Batt_s[][32] = 
{
{0x00,0x00,0x00,0x00,0xF8,0x1F,0xF8,0x1F,0x88,0x08,0x88,0x08,0x88,0x08,0xFF,0x7F,0xFF,0xFF,0x88,0x88,0x88,0x88,0x88,0x88,0xF8,0x9F,0xF8,0x9F,0x00,0xF0,0x00,0xF0},/*"电",0*/
{0x10,0x04,0x70,0x04,0x62,0x7E,0xCE,0x7F,0xCC,0x01,0x80,0x00,0xFC,0x3F,0xFC,0x7F,0x60,0x40,0xFF,0x4F,0xFF,0x4F,0x18,0x44,0xF8,0x47,0xF8,0x47,0x00,0x78,0x00,0x78},/*"池",1*/
};

const unsigned char Charge_s[][32] = 
{
{0x04,0x00,0x04,0x80,0x84,0x80,0xC4,0xC0,0xE4,0x70,0xBC,0x3F,0x9D,0x0F,0x87,0x00,0x86,0x00,0x84,0x7F,0xA4,0xFF,0xE4,0x80,0xC4,0x81,0x84,0xF1,0x04,0xF0,0x04,0x00},/*"充",0*/
{0x00,0x00,0x00,0x00,0xF8,0x1F,0xF8,0x1F,0x88,0x08,0x88,0x08,0x88,0x08,0xFF,0x7F,0xFF,0xFF,0x88,0x88,0x88,0x88,0x88,0x88,0xF8,0x9F,0xF8,0x9F,0x00,0xF0,0x00,0xF0},/*"电",1*/
};


const unsigned char HR_s[][32] = 
{
{0x00,0x10,0x00,0x1C,0x80,0x0F,0x80,0x03,0x00,0x00,0xE0,0x3F,0xE2,0x7F,0x06,0x40,0x1C,0x40,0x18,0x40,0x00,0x40,0x00,0x78,0x40,0x78,0xC0,0x01,0x80,0x0F,0x00,0x0E},/*"心",0*/
{0x00,0x08,0x14,0x09,0xB4,0x09,0xE4,0x08,0x64,0x09,0x34,0x09,0xBD,0x09,0xEF,0xFD,0x66,0xFD,0xB4,0x09,0x94,0x0B,0x44,0x0B,0xE4,0x08,0xB4,0x09,0x14,0x09,0x00,0x08},/*"率",1*/
};

const unsigned char T[][32] = 
{

{0x10,0x80,0xEC,0x7F,0x27,0x09,0xF4,0x3F,0x2C,0x89,0xE0,0xFF,0x00,0x20,0xF8,0x63,0x08,0x21,0x08,0x21,0xFF,0x3F,0x08,0x21,0x08,0x29,0xF8,0x33,0x00,0x60,0x00,0x00},/*"触",0*/

{0x10,0x04,0x10,0x44,0x10,0x82,0xFF,0x7F,0x10,0x01,0x94,0x88,0xE4,0x4B,0xAF,0x2A,0xA4,0x1A,0xA4,0x0E,0xA4,0x1A,0xAF,0x2A,0xE4,0x4B,0x04,0x88,0x00,0x80,0x00,0x00},/*"摸",1*/


};

const unsigned char _OK_[][32] = 
{
{0x00,0x00,0xC0,0x07,0xE0,0x0F,0xF0,0x1F,0x30,0x18,0x18,0x30,0x08,0x20,0x08,0x20,0x08,0x20,0x08,0x20,0x08,0x20,0x18,0x30,0x30,0x18,0xF0,0x1F,0xE0,0x0F,0xC0,0x07},/*"O",0*/
{0x00,0x00,0x08,0x20,0x08,0x20,0xF8,0x3F,0xF8,0x3F,0xF8,0x3F,0x08,0x21,0x88,0x21,0xC0,0x03,0xC0,0x07,0x68,0x2F,0x38,0x3E,0x18,0x3C,0x18,0x38,0x08,0x30,0x08,0x20},/*"K",1*/
};

const unsigned char Text_All_Done[][200] = 
{
{0x00,0x00,0x00,0x00,0x00,0x00,0x80,0xFF,0x00,0x00,0x00,0xF8,0xFF,0x07,0x00,0x00,0xFC,0xFF,0x1F,0x00,0x00,0xFF,0xFF,0x3F,0x00,0x00,0x1F,0x00,0x7E,0x00,0x80,0x03,0x00,0xE0,0x00,0xC0,0x01,0x00,0xC0,0x01,0xC0,0x00,0x00,0x80,0x01,0x40,0x00,0x00,0x00,0x01,0x40,0x00,0x00,0x00,0x01,0x40,0x00,0x00,0x00,0x01,0xC0,0x00,0x00,0x80,0x01,0xC0,0x01,0x00,0xC0,0x01,0x80,0x03,0x00,0xE0,0x00,0x00,0x1F,0x00,0x7C,0x00,0x00,0xFF,0xFF,0x7F,0x00,0x00,0xFC,0xFF,0x1F,0x00,0x00,0xF0,0xFF,0x0F,0x00,0x00,0x80,0xFF,0x00,0x00},/*"O",0*/
{0x00,0x00,0x00,0x00,0x00,0x40,0x00,0x00,0x00,0x01,0x40,0x00,0x00,0x00,0x01,0xC0,0xFF,0xFF,0xFF,0x01,0xC0,0xFF,0xFF,0xFF,0x01,0xC0,0xFF,0xFF,0xFF,0x01,0xC0,0xFF,0xFF,0xFF,0x01,0x40,0x00,0x1C,0x00,0x01,0x40,0x00,0x0F,0x00,0x01,0x00,0x80,0x3F,0x00,0x00,0x00,0xE0,0xFF,0x00,0x00,0x00,0x70,0xFE,0x07,0x00,0x40,0x3C,0xF8,0x1F,0x01,0x40,0x0E,0xC0,0xFF,0x01,0xC0,0x07,0x00,0xFF,0x01,0xC0,0x01,0x00,0xFC,0x01,0xC0,0x00,0x00,0xF0,0x01,0x40,0x00,0x00,0xC0,0x01,0x40,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x01},/*"K",1*/
};

int touch_flag_ = 0;
int touch_cnt = 0;
extern volatile unsigned long touchInterruptCount;

void show_test_ui(void)
{
    if ( 
        (gsensor_ok == 1) && 
        (font_is_ok() == true) && 
        (hr.ok == 1) && 
        (power.ok == 1) && 
        (power.charge_flage == 1) &&
        ( (touchInterruptCount - touch_cnt ) > 0 ) )
    {  
		DrawUI_Bitmap_Ex(20,60,20,40,Text_All_Done[0],0x3F<<5);
		DrawUI_Bitmap_Ex(40,60,20,40,Text_All_Done[1],0x3F<<5);        
    }else {
    
        if ( touch_flag_ == 0 )
        {
            touch_flag_ = 1;
            touch_cnt = touchInterruptCount;
        }
                
        // Font-Chip test
        
        DrawUI_Bitmap( 0,24-8,16,16,FONT_s[0],0xFFFF,0x00);
        DrawUI_Bitmap(16,24-8,16,16,FONT_s[1],0xFFFF,0x00);
        
        if ( osal_systemClock > 2 )
        {
            if ( font_is_ok() == true )
            {	
                DrawUI_Bitmap(56,22-2-8,24,24,OK_,0x3F<<5,0x00);
                    
            }else{
                DrawUI_Bitmap(56,22-2-8,24,24,ERR_,0x1F<<11,0x00);		
            }
        }
        
        // G-Sensor test

        DrawUI_Bitmap( 0,48-8,16,16,GSensor_s[0],0xFFFF,0x00);
        DrawUI_Bitmap(16,48-8,16,16,GSensor_s[1],0xFFFF,0x00);	
        
        if ( osal_systemClock > 34 ) // 34*50=1.7s	
        {
            if (gsensor_ok == 1 )
            {
                DrawUI_Bitmap(56,48-2-8,24,24,OK_,0x3F<<5,0x00);		
            }else
            {
                DrawUI_Bitmap(56,48-2-8,24,24,ERR_,0x1F<<11,0x00);		
            }
        }
        
        DrawUI_Bitmap( 0,72-8,16,16,Batt_s[0],0xFFFF,0x00);
        DrawUI_Bitmap(16,72-8,16,16,Batt_s[1],0xFFFF,0x00);	
        DrawUI_Bitmap( 0,96-8,16,16,Charge_s[0],0xFFFF,0x00);
        DrawUI_Bitmap(16,96-8,16,16,Charge_s[1],0xFFFF,0x00);	
        
        if ( osal_systemClock > 54 ) // 54*50=2700ms
        {
            if ( power.ok == 1 )
            {
                DrawUI_Bitmap(56,72-2-8,24,24,OK_,0x3F<<5,0x00);
            }else{
                DrawUI_Bitmap(56,72-2-8,24,24,ERR_,0x1F<<11,0x00);	
            }
            
            if ( power.charge_flage == 1 )
            {	
                DrawUI_Bitmap(56,96-2-8,24,24,OK_,0x3F<<5,0x00);
            }else
            {
                DrawUI_Bitmap(56,96-2-8,24,24,ERR_,0x1F<<11,0x00);	
            }		
        }
        
        // 显示具体值
            
        UI_Draw_Title_test(37,74-8);

        // Heart Rate mode test

        DrawUI_Bitmap( 0,120-8,16,16,HR_s[0],0xFFFF,0x00);
        DrawUI_Bitmap(16,120-8,16,16,HR_s[1],0xFFFF,0x00);	

        if ( osal_systemClock > 20 )
        {
            if ( hr.ok == 1 )
            {	
                DrawUI_Bitmap(56,120-2-8,24,24,OK_,0x3F<<5,0x00);			
            }else
            {
                DrawUI_Bitmap(56,120-2-8,24,24,ERR_,0x1F<<11,0x00);	
            }		
        }

        DrawUI_Bitmap( 0,120-8+24,16,16,T[0],0xFFFF,0x00);
        DrawUI_Bitmap(16,120-8+24,16,16,T[1],0xFFFF,0x00);
        
        if ( (touchInterruptCount - touch_cnt ) > 0 )
        {
            DrawUI_Bitmap(56,120-2-8+24,24,24,OK_,0x3F<<5,0x00);			
        }else
        {
            DrawUI_Bitmap(56,120-2-8+24,24,24,ERR_,0x1F<<11,0x00);
        }    
    }
}
#endif

#include "Task_Flash.h"

unsigned long win_main_proc(unsigned long wid, unsigned long msg_type, 
                            unsigned long msg_param, unsigned long *p)
{
	if ( msg_type & WINDOW_CREATE )
	{
		win_ticks = 0; // test_enable = 1;
				
		osal_set_event( taskGUITaskId, TASK_GUI_UPDATE_EVT );
		
		return ( msg_type ^ WINDOW_CREATE );
	}
	
	if ( msg_type & WINDOW_UPDATE )
	{
		win_ticks++;
		
		if ( win_ticks > 3 )
		{
			showLogoFlag = 0;
			fristBootFlag = 0;
		}

		#if (OTA_MODE_ENABLE==0)
		if ( (win_ticks > 5) && ((config.test_mdoe == 0) && (test_lock==0)) )		
		#else	
		if ( win_ticks > 5 )				
		#endif					
		{
			lcd_display(0);
			
			return ( msg_type ^ WINDOW_UPDATE );
		}

		memset( frame_buffer, 0, sizeof(frame_buffer));

		if ( showLogoFlag == 1 )
		{
			if ( win_ticks > 1 )
			{
				if ( fristBootFlag == 1 )
				{
					show_ui_version();
				}else{
					show_ui_logo();
				}
			}
		}else
		{		
			#if (OTA_MODE_ENABLE==0)			
			if ( (config.test_mdoe == 1) || (test_lock == 1))
			{
				show_test_ui();
			}else{
			#endif	
				if ( config.ui_style == 0 )
				{
					show_main_ui_style_1();				
				}else
				{
					show_main_ui_style_2(TimerHH(), TimerMI(), TimerSE());
				}
			#if (OTA_MODE_ENABLE==0)	
			}
			#endif
		}
		if ( config.lcdEnable == 0 )
		{
			lcd_display(1);
		}			
		
		sync_frame();
		
		osal_start_timerEx( taskGUITaskId, TASK_GUI_UPDATE_EVT, 500);
		
		return ( msg_type ^ WINDOW_UPDATE );
	}
	
	if ( msg_type & WINDOW_TOUCH )
	{	
		win_ticks = 0;
		
		if ( config.lcdEnable == 0 )
		{
			osal_set_event( taskGUITaskId, TASK_GUI_UPDATE_EVT );
		}else{
			
			showLogoFlag = 0; // 显示Vxxx期间按键.
			
			#if (OTA_MODE_ENABLE==0)			
			if ( config.test_mdoe == 1 )
			{
				return ( msg_type ^ WINDOW_TOUCH );
			}			
			#endif
			
			window_push(window_get(win_current));
			msg_type |= WINDOW_DISTORY;
		}	

        osal_set_event( taskGUITaskId, TASK_GUI_UPDATE_EVT );		
		
		return ( msg_type ^ WINDOW_TOUCH );
	}
	
	if ( msg_type & WINDOW_PRESS )
	{
		win_ticks = 0;
		
		if ( config.lcdEnable == 0 )
		{
			msg_type |= WINDOW_UPDATE;
			
			return ( msg_type ^ WINDOW_PRESS );
		}else {
		}
		
		msg_type |= WINDOW_UPDATE;
		
		return ( msg_type ^ WINDOW_PRESS );
	}
	
	if ( msg_type & WINDOW_NOTIFY )
	{   
        /* 当前窗体入栈 */
        window_push( win_current );
        
        /* 通知界面作为当前界面 */
        win_current = NOTIFY_WIN_ID_GET();
        
        /* 调用窗体回调函数以便创建窗体  */
        window[win_current].wproc( win_current, WINDOW_CREATE, 0, 0);
		
		return ( msg_type ^ WINDOW_NOTIFY );
	}
	
	if ( msg_type & WINDOW_DISTORY )
	{
		window_pop(&win_current);
		
		return window[win_current].wproc( win_current, WINDOW_CREATE, 0, 0 );
	}

    return 0;
}

